@using LaboratoryWork3.Models.Data
@using LaboratoryWork3.ViewModels
@using System.Diagnostics
@using System.ComponentModel.DataAnnotations
@using Microsoft.AspNetCore.Components.Forms
@inject UserAuthenticationViewModel UserAuthenticationViewModel

<Modal @ref="SignUpModal">
    <ModalHeader>
        <h3 class="text-info">Register</h3>
    </ModalHeader>
    <ModalBody>
        <div class="form-group">
            <label for="email">Email:</label>
            <input id="email" class="form-control" @bind="@user.Email"/>
        </div>
        <div class="form-group">
            <label for="password">Password:</label>
            <input id="password" type="password" class="form-control" @bind="@user.Password"/>
        </div>
        <button @onclick="@SignUpUser" class="btn btn-primary">Register</button>
    </ModalBody>
</Modal>

@code {
    private User user = new User();
    private Modal SignUpModal;

    private async Task  SignUpUser()
    {
        var validationResults = new List<ValidationResult>();
        var validationContext = new ValidationContext(user);

        if(!Validator.TryValidateObject(user, validationContext, validationResults, true))
        {
            foreach (var validationResult in validationResults)
            {
                Debug.WriteLine(validationResult.ErrorMessage);
            }
            return;
        }
        else
        {
            await UserAuthenticationViewModel.SignUpAsync(user.Email, user.Password);
            SignUpModal.Hide();
        }
    }

    public void Show() => SignUpModal.Show();
}
